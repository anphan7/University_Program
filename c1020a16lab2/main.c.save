/* File: main.c
   Name: Peter Phan
   Description:
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "athlete.h"
#include "ultilies.h"
#include "node.h"
#include "list.h"

int main (int argc, char* argv[]){
	FILE* inFile;
	dbl_linked_list_t list; // send list by reference everytime use 
	node_t* nodePtr;
	athlete_t a;
	char fileName[MAX_CHAR];
	int choice_number;
	createList (&list);
	char answer[MAX_CHAR];
	if (argc == 2 ){
		strcpy (fileName, argv[1]);
	}
	else{
		printf ("Usage: lab2 filename\n");
		return (0);
	}
	inFile = fopen (fileName, "rb");

	if (inFile == NULL){
		printf("Input file %s is doesn't exist. Please contact the administrator.\n", inFile);
		return (0);
	}	
	else {	
		 // if inFile != NULL
		fread(&a, sizeof(athlete_t), 1, inFile); // inside sizeof need type
		while ( !feof (inFile) ){
			fread(&a, sizeof(athlete_t), 1, inFile); 
		}
		do{
			print_Athlete(a);
			choice_number = printMenu (choice_number);
			
			if (choice_number == 1){
				printf("Country code: ");
				scanf ("%s", answer);
				to_Upper(answer);
				printf ("%s Medals\n", answer);
				insertNode (&list, nodePtr);
				nodePtr = initNode (a);
				find_Country (&list, answer);		 
			}
			else if (choice_number == 2){
				printf("Athlete: ");
				scanf ("%s", answer);
				to_Upper (answer);
				insertNode (&list, nodePtr);
				nodePtr = initNode (a);
				find_Athlete (&list, answer);
			}
			else if (choice_number == 3) {
				printf("Thank you for using the program\n");
				return (0);
			}
			else 
				printf("Invalid option: %d\n", choice_number);
		}while ((choice_number > 3) || (choice_number < 1));

		fclose (inFile); // close the file 
	}

}
